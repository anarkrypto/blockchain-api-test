# Teste de Especialista Blockchain

Este projeto implementa uma API REST em Python para interagir com a blockchain Ethereum, seguindo as [instruções do desafio](docs/teste-dev-blockchain.pdf).

## Author

Kaique Nunes <anarkrypto@gmail.com>

## Technologies

- **Python**: v3.10
- **uv**: a fast python package and project manager
- **FastAPI**: modern web framework for building APIs with Python
- **Pydantic**: Data validation and settings management
- **Pytest**: a mature full-featured Python testing tool
- **Sqlite**: a lightweight database
- **Alembic**: a database migration tool
- **SQLAlchemy**: a powerful ORM
- **Web3.py**: a Python library for interacting with the Ethereum blockchain and ecosystem
- **eth-account**: a Python library for signing and verifying Ethereum transactions
- **bip-utils**: a Python library for working with Ethereum addresses and mnemonic phrases
- **eth-tester**: a Python library for testing Ethereum applications

## Docs

When running, you can access the API documentation at:

- API Docs: [http://localhost:8000/docs](http://localhost:8000/docs)

It's a Swagger + OpenAPI spec auto generated by FastAPI.

## Features

- **Generate Address API**

  - Gera uma quantidade de endereços ETH compatível apartir da MNEMONIC
  - Persiste os endereços no banco de dados utilizando index, garantindo segurança da private_key

- **List Addresses API**

  - Lista os endereços gerados com paginação

- **Process Transaction API**

  - Detecta transferência Ethereum (externas e internas) e USDC (ERC20) via `alchemy_getAssetTransfers` RPC
  - Atualiza o saldo do endereço de destino se existir no banco de dados e armazena a transação
  - Suporte a Ethereum Mainnet ou Sepolia

- **Withdraw API**

  - Realiza o saque de um endereço para outro
  - Suporta ETH ou USDC
  - Persiste a transação no banco de dados
  - Suporte a Ethereum Mainnet ou Sepolia

- **List Transactions History API**

  - Lista as transações de um endereço
  - Suporta Ethereum Mainnet ou Sepolia

- **Receipt Processor (Worker/Listener)**

  - Processa as transações pendentes em thread separado, aguardando confirmação da rede e atualiza o status da transação e saldo do endereço de destino

- **Tests**
  - Testes unitários
  - Testes de integração para a API

## Install

1. Estaremos utilizando a ferramenta `uv` para facilitar o desenvolvimento.
   Guia de instalação do `uv`: https://docs.astral.sh/uv/getting-started/installation/

2. Instale a versão do Python utilizada no projeto:

```bash
uv python install 3.10
uv python pin 3.10
```

3. Instale as dependências:

```bash
uv sync
```

## Config

- Copie o arquivo `.env.example` para `.env` e configure as variáveis de ambiente.

Garanta utilizar uma ALCHEMY_API_KEY válida, você pode gerar uma em https://dashboard.alchemy.com/

## Database

O banco de dados utilizado é o Sqlite, ele é um banco de dados leve e fácil de configurar, perfeito para testes.
Mas a migração para outros banco de dados como Postgres, MySQL, etc. é simples caso necessário.

### Migrations

```bash
uv run alembic upgrade head
```

## Running

```bash
uv run fastapi dev app/main.py
```

## Test

```bash
uv run pytest -s -vv
```

## Extensions for VSCode (Development only)

- charliermarsh.ruff
- matangover.mypy

## Considerations

- Este é apenas um projeto de teste, não deve ser utilizado em produção sem consideráveis ajustes.
- Para produção é indispensável adicionar autenticação nas APIs por segurança.
- Obrigado!
